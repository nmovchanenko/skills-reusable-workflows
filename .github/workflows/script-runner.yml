name: Run JS script

on:
  schedule:
    - cron: '00 14 * * *'

  workflow_dispatch:
    inputs:
      environment_name:
        description: "Select Environment"
        required: false
        type: choice
        default: "integration"
        options:
          - ''
          - "staging"
          - "integration"

permissions: write-all

env:
  environment_name: ${{ inputs.environment_name || 'staging'}}

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install packages
        run: npm i

      - name: Print
        run: env | sort

      - name: Run Script if isScheduled
        if: ${{ github.event_name == 'schedule'}}
        run: |
          echo 'this is for scheduled only:'
          echo ${{ github.event_name == 'schedule'}}
          echo ${{ env.environment_name }}

      - name: Run Script if NOT isScheduled
        if: ${{ github.event_name != 'schedule'}}
        run: |
          echo 'this is for NOT scheduled only:'
          echo ${{ github.event_name == 'schedule'}}
          echo ${{ env.environment_name }}

      - name: Run Playwright Tests
        shell: bash
        run: |
          echo '{
                "runId": "RUN_TOKEN",
                "action": "getTestList",
                "args": {
                  "environment": "environment",
                  "limitTests": "testCaseIdentifiers",
                  "slackChannel": "slackChannel",
                  "createTestRunInTestRail": "createTestRunInTestRail",
                  "reportTitle": "reportTitle",
                  "statusAutoinvite": "statusAutoinvite",
                  "dispatchParams": "dispatchParams"
                }
              }'

      - name: Run Script
        run: |
          echo ${{ inputs.environment_name }}
          echo ${{ github.repository }}
          echo ${{ github.repository_owner }}
          echo ${{ secrets.TOKEN }}
          echo ${{ secrets.github_token }}
          echo ${{ env.isScheduled }}
          echo ${{ env.environment_name }}

          ENV=${{ inputs.environment_name }} REPO_OWNER=${{ github.repository_owner }} REPO_NAME=${{ github.repository }} GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }} node src/index.js
